# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-16
**Phases:** 1-7
**Total Plans:** 13

## Overview

A complete macOS disk cleaning CLI tool with safe scanning across 4 categories (system caches, browser data, developer caches, app leftovers), interactive and scripted modes, granular skip controls, JSON output for AI agents, and risk-aware safety enforcement.

## Phases

### Phase 1: Project Setup & Safety Foundation

**Goal**: Project scaffolding exists and safety layer prevents catastrophic failures
**Depends on**: Nothing (first phase)
**Plans**: 2 plans

Plans:

- [x] 01-01: Go project scaffolding with Cobra CLI and --version flag
- [x] 01-02: Safety layer with TDD (IsPathBlocked for SIP/swap protection)

**Details:**
- Go module initialized with Cobra CLI framework
- IsPathBlocked rejects SIP-protected paths (/System, /usr, /bin, /sbin) and swap/VM paths
- /usr/local exempted from SIP blocking
- filepath.Clean catches path traversal, EvalSymlinks catches symlinks to protected paths
- pathHasPrefix uses path separator boundary to prevent false positives

### Phase 2: System Cache Scanning

**Goal**: User can scan system caches with dry-run preview showing space reclaimable
**Depends on**: Phase 1
**Plans**: 2 plans

Plans:

- [x] 02-01: Core scan types and size utilities (TDD)
- [x] 02-02: System scanner, CLI wiring, and formatted output

**Details:**
- Shared struct types (ScanEntry, CategoryResult, ScanSummary) for all scanners
- DirSize with WalkDir, error-skipping for resilient directory traversal
- FormatSize using SI units matching macOS Finder convention
- System scanner covers Caches, Logs, QuickLook directories
- CLI flow: --system-caches --dry-run produces formatted colored output

### Phase 3: Browser & Developer Caches

**Goal**: User can scan browser data and developer caches with same dry-run architecture
**Depends on**: Phase 2
**Plans**: 2 plans

Plans:

- [x] 03-01: Browser scanner (Safari/Chrome/Firefox), shared ScanTopLevel extraction, printResults generalization
- [x] 03-02: Developer scanner (Xcode/npm/yarn/Homebrew/Docker) with CLI integration

**Details:**
- Browser scanner: Safari (TCC permission handling), Chrome (multi-profile), Firefox
- Developer scanner: Xcode DerivedData, npm, yarn, Homebrew, Docker (with CLI integration)
- Shared ScanTopLevel helper extracted to internal/scan/helpers.go
- Docker integration with 10-second timeout, JSON parsing, graceful failure
- CmdRunner dependency injection for testability

### Phase 4: App Leftovers & Cleanup Execution

**Goal**: User can scan app leftovers and execute actual cleanup with confirmation
**Depends on**: Phase 3
**Plans**: 2 plans

Plans:

- [x] 04-01: App leftovers scanner (orphaned prefs, iOS backups, old Downloads) with CLI wiring
- [x] 04-02: Confirmation prompt, cleanup execution, and deletion flow wiring

**Details:**
- Orphaned preference detection via PlistBuddy (com.apple.* excluded)
- iOS backup scanning, old Downloads with 90-day threshold
- Confirmation prompt requires exact "yes" to proceed
- Cleanup re-checks IsPathBlocked before every deletion
- Pseudo-paths with ":" skipped in filesystem operations

### Phase 5: Interactive Mode

**Goal**: User can run walkthrough mode that asks keep/remove for each cleaning item
**Depends on**: Phase 4
**Plans**: 1 plan

Plans:

- [x] 05-01: Interactive walkthrough package and CLI wiring

**Details:**
- RunWalkthrough presents items one-by-one with progress indicators
- k/keep and r/remove input, EOF defaults to keep
- Default no-args CLI behavior (replaces help output)
- Shared bufio.Reader for seamless walkthrough-to-confirmation flow

### Phase 6: CLI Polish & Automation

**Goal**: User can automate cleaning with flags and get structured output for AI agents
**Depends on**: Phase 5
**Plans**: 2 plans

Plans:

- [x] 06-01: JSON struct tags, --all flag, --json output, --verbose display, PreRun hook
- [x] 06-02: Skip flags (4 category + 12 item), --force confirmation bypass, filtering functions

**Details:**
- --all, --json, --verbose flags with PreRun hook
- JSON output: valid, parseable, with categories/entries/sizes
- 4 category-level skip flags, 12 item-level skip flags
- --force bypasses confirmation (not safety layer)
- Skip flags compose with --all

### Phase 7: Safety Enforcement

**Goal**: User sees risk categorization for all items and tool respects permission boundaries
**Depends on**: Phase 6
**Plans**: 2 plans

Plans:

- [x] 07-01: Risk types, mapping function, and scanner integration
- [x] 07-02: Risk-aware display, confirmation warnings, permission issue reporting

**Details:**
- Risk levels (safe/moderate/risky) assigned to all 14 category IDs
- Risk-colored tags in scan output, confirmation, and interactive walkthrough
- Bold red WARNING for risky items in confirmation
- Permission issues reported to stderr (JSON mode: in payload)
- Unknown category IDs default to moderate

---

## Milestone Summary

**Decimal Phases:** None (all integer phases)

**Key Decisions:**

- Go with Cobra CLI framework for single binary distribution
- macOS only — leveraging macOS-specific paths and APIs
- SI units (base 1000) for FormatSize to match macOS Finder convention
- Safety layer with hardcoded protections (no config can override)
- Interactive mode as default no-args behavior
- Exact "yes" required for confirmation
- --force bypasses confirmation only, not safety layer
- Risk constants in safety package to avoid circular imports
- Permission issues to stderr (not stdout) to avoid contaminating pipeable output

**Issues Resolved:**

- Safari TCC permission denial handled as structured PermissionIssue
- Chrome multi-profile directory discovery
- Docker graceful failure when not installed or daemon stopped
- Path traversal and symlink attacks prevented at safety layer

**Issues Deferred:**

- Configurable download age threshold (hardcoded 90 days)
- Extended cleaning categories (v2 requirements)
- Homebrew tap distribution
- Code signing and notarization

**Technical Debt Incurred:**

- None significant — clean first milestone

---

_For current project status, see .planning/ROADMAP.md_
